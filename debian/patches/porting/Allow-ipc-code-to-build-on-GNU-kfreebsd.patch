From: Mike Hommey <mh@glandium.org>
Date: Thu, 30 Jun 2011 18:29:22 +0200
Subject: Allow ipc code to build on GNU/kfreebsd

---
 mozilla/ipc/chromium/src/base/platform_thread_posix.cc    |    4 ++++
 mozilla/ipc/chromium/src/base/third_party/nspr/prcpucfg.h |    2 +-
 mozilla/ipc/chromium/src/build/build_config.h             |    2 +-
 3 files changed, 6 insertions(+), 2 deletions(-)

Index: icedove/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
===================================================================
--- icedove.orig/mozilla/ipc/chromium/src/base/platform_thread_posix.cc	2012-10-13 14:27:19.634188821 +0530
+++ icedove/mozilla/ipc/chromium/src/base/platform_thread_posix.cc	2012-10-13 15:57:12.286439284 +0530
@@ -42,7 +42,11 @@
   // TODO(BSD): find a better thread ID
   return (intptr_t)(pthread_self());
 #elif defined(OS_LINUX)
+#ifdef __NR_gettid
   return syscall(__NR_gettid);
+#else
+  return getpid();
+#endif
 #endif
 }
 
Index: icedove/mozilla/ipc/chromium/src/base/third_party/nspr/prcpucfg.h
===================================================================
--- icedove.orig/mozilla/ipc/chromium/src/base/third_party/nspr/prcpucfg.h	2012-10-13 14:20:18.866169279 +0530
+++ icedove/mozilla/ipc/chromium/src/base/third_party/nspr/prcpucfg.h	2012-10-13 15:57:12.286439284 +0530
@@ -34,7 +34,7 @@
 #include "base/third_party/nspr/prcpucfg_win.h"
 #elif defined(__APPLE__)
 #include "base/third_party/nspr/prcpucfg_mac.h"
-#elif defined(__linux__) || defined(ANDROID)
+#elif defined(__linux__) || defined(ANDROID) || defined(__GLIBC__)
 #include "base/third_party/nspr/prcpucfg_linux.h"
 #elif defined(__OpenBSD__)
 #include "base/third_party/nspr/prcpucfg_openbsd.h"
Index: icedove/mozilla/ipc/chromium/src/build/build_config.h
===================================================================
--- icedove.orig/mozilla/ipc/chromium/src/build/build_config.h	2012-10-13 14:20:18.874169279 +0530
+++ icedove/mozilla/ipc/chromium/src/build/build_config.h	2012-10-13 15:57:12.286439284 +0530
@@ -17,7 +17,7 @@
 // A set of macros to use for platform detection.
 #if defined(__APPLE__)
 #define OS_MACOSX 1
-#elif defined(__linux__) || defined(ANDROID)
+#elif defined(__linux__) || defined(ANDROID) || defined(__GLIBC__)
 #define OS_LINUX 1
 #elif defined(__OpenBSD__)
 #define OS_OPENBSD 1
