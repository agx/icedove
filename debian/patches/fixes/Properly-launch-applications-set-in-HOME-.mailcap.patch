From: Mike Hommey <glandium@debian.org>
Date: Sat, 22 Nov 2008 09:35:23 +0100
Subject: Properly launch applications set in $HOME/.mailcap

https://bugzilla.mozilla.org/show_bug.cgi?id=444440


---
 mozilla/uriloader/exthandler/unix/nsMIMEInfoUnix.cpp |   12 ++++++++++++
 1 file changed, 12 insertions(+)

Index: icedove/mozilla/uriloader/exthandler/unix/nsMIMEInfoUnix.cpp
===================================================================
--- icedove.orig/mozilla/uriloader/exthandler/unix/nsMIMEInfoUnix.cpp	2012-10-15 20:21:34.895201731 +0530
+++ icedove/mozilla/uriloader/exthandler/unix/nsMIMEInfoUnix.cpp	2012-10-15 20:22:28.063204200 +0530
@@ -65,6 +65,12 @@
 NS_IMETHODIMP
 nsMIMEInfoUnix::GetHasDefaultHandler(bool *_retval)
 {
+  // if mDefaultApplication is set, it means the application has been set from
+  // either /etc/mailcap or ${HOME}/.mailcap, in which case we don't want to
+  // give the GNOME answer.
+  if (mDefaultApplication)
+    return nsMIMEInfoImpl::GetHasDefaultHandler(_retval);
+
   *_retval = false;
   nsRefPtr<nsMIMEInfoBase> mimeInfo = nsGNOMERegistry::GetFromType(mSchemeOrType);
   if (!mimeInfo) {
@@ -105,6 +111,12 @@
 nsresult
 nsMIMEInfoUnix::LaunchDefaultWithFile(nsIFile *aFile)
 {
+  // if mDefaultApplication is set, it means the application has been set from
+  // either /etc/mailcap or ${HOME}/.mailcap, in which case we don't want to
+  // give the GNOME answer.
+  if (mDefaultApplication)
+    return nsMIMEInfoImpl::LaunchDefaultWithFile(aFile);
+
   nsCAutoString nativePath;
   aFile->GetNativePath(nativePath);
 
