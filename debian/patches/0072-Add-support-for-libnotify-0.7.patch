From: Christoph Goehre <chris@sigxcpu.org>
Date: Sun, 27 Mar 2011 15:00:33 +0200
Subject: Add support for libnotify-0.7+

https://bugzilla.mozilla.org/show_bug.cgi?id=628222
---
 .../toolkit/system/gnome/nsAlertsIconListener.cpp  |   13 ++++++++++++-
 1 files changed, 12 insertions(+), 1 deletions(-)

diff --git a/mozilla/toolkit/system/gnome/nsAlertsIconListener.cpp b/mozilla/toolkit/system/gnome/nsAlertsIconListener.cpp
index bad7f64..b61c0de 100644
--- a/mozilla/toolkit/system/gnome/nsAlertsIconListener.cpp
+++ b/mozilla/toolkit/system/gnome/nsAlertsIconListener.cpp
@@ -47,6 +47,11 @@
 #include <libnotify/notify.h>
 #include <gdk/gdk.h>
 
+// Compatibility macro for <libnotify-0.7
+#ifndef NOTIFY_CHECK_VERSION
+#define NOTIFY_CHECK_VERSION(x,y,z) 0
+#endif
+
 static PRBool gHasActions = PR_FALSE;
 
 static void notify_action_cb(NotifyNotification *notification,
@@ -204,7 +209,13 @@ nsAlertsIconListener::ShowAlert(GdkPixbuf* aPixbuf)
 {
   NotifyNotification* notify = notify_notification_new(mAlertTitle.get(),
                                                        mAlertText.get(),
-                                                       NULL, NULL);
+                                                       NULL
+// >=libnotify-0.7.0 has no support for attaching to widgets
+#if !NOTIFY_CHECK_VERSION(0,7,0)
+                                          , NULL
+#endif
+                                          );
+
   if (!notify)
     return NS_ERROR_OUT_OF_MEMORY;
 
-- 
