From: Mike Hommey <mh@glandium.org>
Date: Thu, 28 Jan 2010 18:08:38 +0100
Subject: Install missing nanojit and .tbl headers from js/src

https://bugzilla.mozilla.org/show_bug.cgi?id=542789

---
 mozilla/js/src/Makefile.in |   48 ++++++++++++++++++++++++++++---------------
 1 files changed, 31 insertions(+), 17 deletions(-)

diff --git a/mozilla/js/src/Makefile.in b/mozilla/js/src/Makefile.in
index 1be068f..1cd0ba7 100644
--- a/mozilla/js/src/Makefile.in
+++ b/mozilla/js/src/Makefile.in
@@ -229,6 +229,7 @@ INSTALLED_HEADERS = \
 		jsxdrapi.h \
 		jsval.h \
 		prmjtime.h \
+		jskeyword.tbl \
 		$(NULL)
 
 ######################################################
@@ -295,21 +296,21 @@ VPATH		+= \
 
 INSTALLED_HEADERS += \
 		jsbuiltins.h    \
-		Assembler.h     \
-		Allocator.h     \
-		CodeAlloc.h     \
-		Containers.h    \
-		LIR.h		\
-		LIRopcode.tbl \
-		avmplus.h	\
-		Fragmento.h	\
-		Native.h	\
-		NativeCommon.h	\
-		Native$(NANOJIT_ARCH).h \
-		njconfig.h      \
-		njcpudetect.h   \
-		RegAlloc.h	\
-		nanojit.h	\
+		nanojit/Assembler.h     \
+		nanojit/Allocator.h     \
+		nanojit/CodeAlloc.h     \
+		nanojit/Containers.h    \
+		nanojit/LIR.h		\
+		nanojit/LIRopcode.tbl	\
+		nanojit/avmplus.h	\
+		nanojit/Fragmento.h	\
+		nanojit/Native.h	\
+		nanojit/NativeCommon.h	\
+		nanojit/Native$(NANOJIT_ARCH).h \
+		nanojit/RegAlloc.h	\
+		nanojit/njconfig.h      \
+		nanojit/njcpudetect.h   \
+		nanojit/nanojit.h	\
 		VMPI.h		\
 		Writer.h	\
 		$(NULL)
@@ -544,7 +545,15 @@ else
 CPPSRCS += pm_stub.cpp
 endif
 
-EXPORTS = $(INSTALLED_HEADERS)
+EXPORTS = $(filter-out nanojit/%,$(INSTALLED_HEADERS))
+ifeq ($(OS_ARCH),WINNT)
+INSTALLED_HEADERS += jscpucfg.h
+endif
+
+ifdef ENABLE_TRACEJIT
+EXPORTS_NAMESPACES  += nanojit
+EXPORTS_nanojit = $(filter nanojit/%,$(INSTALLED_HEADERS))
+endif # ENABLE_TRACEJIT
 
 DASH_R		= -r
 
@@ -918,7 +927,12 @@ js-config: js-config.in Makefile $(DEPTH)/config/autoconf.mk $(topsrcdir)/config
 SCRIPTS = js-config
 SDK_BINARY = js-config
 
-install:: $(INSTALLED_HEADERS)
+ifdef ENABLE_TRACEJIT
+install:: $(filter nanojit/%,$(INSTALLED_HEADERS))
+	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)/nanojit
+endif
+
+install:: $(filter-out nanojit/%,$(INSTALLED_HEADERS))
 	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)
 
 install:: $(SCRIPTS)
