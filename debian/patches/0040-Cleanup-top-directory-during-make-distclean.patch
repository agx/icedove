From: Mike Hommey <glandium@debian.org>
Date: Wed, 17 Feb 2010 15:48:54 +0100
Subject: [PATCH] Cleanup top directory during make distclean

https://bugzilla.mozilla.org/show_bug.cgi?id=546642
---
 Makefile.in                 |    9 +++++++++
 suite/app/Makefile.in       |    2 +-
 suite/installer/Makefile.in |    2 ++
 suite/locales/Makefile.in   |    2 ++
 4 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index 75b14ef..44f3300 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -75,3 +75,12 @@ buildsymbols ::
 	$(MAKE) -C mozilla MAKE_SYM_STORE_PATH=$(MAKE_SYM_STORE_PATH) SYM_STORE_SOURCE_DIRS="$(topsrcdir)/mozilla/extensions/inspector $(topsrcdir)/mozilla $(topsrcdir)" $@
 
 include $(topsrcdir)/config/rules.mk
+
+distclean::
+	cat unallmakefiles | $(XARGS) rm -f
+	rm -f unallmakefiles $(DIST_GARBAGE)
+
+DIST_GARBAGE = config.cache config.log config.status \
+   config/autoconf.mk \
+   unallmakefiles comm-config.h \
+   $(topsrcdir)/.mozconfig.mk $(topsrcdir)/.mozconfig.out
diff --git a/suite/app/Makefile.in b/suite/app/Makefile.in
index 36e9403..8c0f4e0 100644
--- a/suite/app/Makefile.in
+++ b/suite/app/Makefile.in
@@ -264,7 +264,7 @@ libs:: $(MOZ_APP_NAME)
 install:: $(MOZ_APP_NAME)
 	$(SYSINSTALL) $< $(DESTDIR)$(bindir)
 
-GARBAGE += $(MOZ_APP_NAME)
+GARBAGE += $(MOZ_APP_NAME) $(MOZ_APP_NAME).1
 GARBAGE += $(addprefix $(DIST)/bin/defaults/pref/, browser-prefs.js)
 endif
 
diff --git a/suite/installer/Makefile.in b/suite/installer/Makefile.in
index 4604da1..9d53ed4 100644
--- a/suite/installer/Makefile.in
+++ b/suite/installer/Makefile.in
@@ -88,6 +88,8 @@ MOZ_PKG_MANIFEST = packages
 
 $(MOZ_PKG_MANIFEST): $(MOZ_PKG_MANIFEST_P)
 	$(PERL) $(MOZILLA_SRCDIR)/config/preprocessor.pl $(DEFINES) $(ACDEFINES) $< > $@
+
+GARBAGE += $(MOZ_PKG_MANIFEST)
 endif
 
 ifeq ($(MOZ_WIDGET_TOOLKIT),cocoa)
diff --git a/suite/locales/Makefile.in b/suite/locales/Makefile.in
index 684e44a..1e0f5cf 100644
--- a/suite/locales/Makefile.in
+++ b/suite/locales/Makefile.in
@@ -165,6 +165,8 @@ SEARCH_PLUGINS = $(shell cat \
 	done
 	$(PYTHON) $(MOZILLA_SRCDIR)/config/Preprocessor.py profile/search.rdf.in > $@
 
+GARBAGE_DIRS += profile
+
 libs:: $(FINAL_TARGET)/defaults/profile/bookmarks.html ;
 libs:: $(FINAL_TARGET)/defaults/profile/search.rdf ;
 libs:: $(FINAL_TARGET)/defaults/profile/panels.rdf ;
-- 
