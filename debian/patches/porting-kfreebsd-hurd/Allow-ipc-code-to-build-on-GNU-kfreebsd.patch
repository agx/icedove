From: Mike Hommey <mh@glandium.org>
Date: Thu, 30 Jun 2011 18:29:22 +0200
Subject: Allow ipc code to build on GNU/kfreebsd

---
 mozilla/ipc/chromium/src/base/platform_thread_posix.cc | 6 +++++-
 mozilla/ipc/chromium/src/build/build_config.h          | 2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/mozilla/ipc/chromium/src/base/platform_thread_posix.cc b/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
index e853c4f..f35daaf 100644
--- a/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
+++ b/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
@@ -49,7 +49,11 @@ PlatformThreadId PlatformThread::CurrentId() {
   mach_port_deallocate(mach_task_self(), port);
   return port;
 #elif defined(OS_LINUX)
-  return syscall(__NR_gettid);
+#ifdef __NR_gettid
+   return syscall(__NR_gettid);
+#else
+   return getpid();
+#endif
 #elif defined(OS_OPENBSD) || defined(__GLIBC__)
   return (intptr_t) (pthread_self());
 #elif defined(OS_NETBSD)
diff --git a/mozilla/ipc/chromium/src/build/build_config.h b/mozilla/ipc/chromium/src/build/build_config.h
index 32a086d..aea9f62 100644
--- a/mozilla/ipc/chromium/src/build/build_config.h
+++ b/mozilla/ipc/chromium/src/build/build_config.h
@@ -17,7 +17,7 @@
 // A set of macros to use for platform detection.
 #if defined(__APPLE__)
 #define OS_MACOSX 1
-#elif defined(__linux__) || defined(ANDROID)
+#elif defined(__linux__) || defined(ANDROID) || defined(__GLIBC__)
 #define OS_LINUX 1
 #elif defined(__DragonFly__)
 #define OS_DRAGONFLY 1
