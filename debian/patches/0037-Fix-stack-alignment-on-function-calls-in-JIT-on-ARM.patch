From: Mike Hommey <mh@glandium.org>
Date: Sun, 14 Feb 2010 11:29:45 +0100
Subject: [PATCH] Fix stack alignment on function calls in JIT on ARM

https://bugzilla.mozilla.org/show_bug.cgi?id=545747
---
 mozilla/js/src/nanojit/NativeARM.cpp |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/mozilla/js/src/nanojit/NativeARM.cpp b/mozilla/js/src/nanojit/NativeARM.cpp
index bcb4bb8..f11a0cb 100644
--- a/mozilla/js/src/nanojit/NativeARM.cpp
+++ b/mozilla/js/src/nanojit/NativeARM.cpp
@@ -410,6 +410,11 @@ Assembler::asm_call(LInsp ins)
 
         asm_arg(sz, arg, r, stkd);
     }
+#ifdef NJ_ARM_EABI
+    // On EABI, the overall stack must be 64-bits aligned
+    if ((stkd&7) != 0)
+        SUBi(SP, SP, 4);
+#endif
 }
 
 void
-- 
