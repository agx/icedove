From: Mike Hommey <mh@glandium.org>
Date: Fri, 5 Feb 2010 20:31:42 +0100
Subject: Fixes for misaligned accesses on sparc in uconv

https://bugzilla.mozilla.org/show_bug.cgi?id=544512
---
 mozilla/intl/uconv/ucvlatin/nsUCS2BEToUnicode.cpp |    4 ++++
 mozilla/intl/uconv/ucvlatin/nsUTF32ToUnicode.cpp  |    2 +-
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/mozilla/intl/uconv/ucvlatin/nsUCS2BEToUnicode.cpp b/mozilla/intl/uconv/ucvlatin/nsUCS2BEToUnicode.cpp
index 5d73277..10db9ed 100644
--- a/mozilla/intl/uconv/ucvlatin/nsUCS2BEToUnicode.cpp
+++ b/mozilla/intl/uconv/ucvlatin/nsUCS2BEToUnicode.cpp
@@ -130,7 +130,11 @@ UTF16ConvertToUnicode(PRUint8& aState, PRUint8& aOddByte,
     if (dest == destEnd)
       goto error;
 
+#ifndef __sparc__
     u = *(const PRUnichar*)src;
+#else
+    memcpy(&u, src, 2);
+#endif
     src += 2;
 
 have_codepoint:
diff --git a/mozilla/intl/uconv/ucvlatin/nsUTF32ToUnicode.cpp b/mozilla/intl/uconv/ucvlatin/nsUTF32ToUnicode.cpp
index a16cb5b..79ac7f2 100644
--- a/mozilla/intl/uconv/ucvlatin/nsUTF32ToUnicode.cpp
+++ b/mozilla/intl/uconv/ucvlatin/nsUTF32ToUnicode.cpp
@@ -54,7 +54,7 @@
 #define LE_STRING_TO_UCS4(s) (*(PRUint32*) (s))
 #endif
 
-#ifdef IS_BIG_ENDIAN
+#if defined(IS_BIG_ENDIAN) && !defined(__sparc__)
 #define BE_STRING_TO_UCS4(s) (*(PRUint32*) (s))
 #else
 #define BE_STRING_TO_UCS4(s)                                       \
-- 
