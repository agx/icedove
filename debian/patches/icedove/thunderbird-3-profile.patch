From: Alexander Sack <asac@debian.org>
Date: Wed, 27 Jan 2010 19:05:42 +0100
Subject: thunderbird-3-profile

---
 config/autoconf.mk.in         |    8 ++++----
 mail/app/application.ini      |    2 +-
 mail/confvars.sh              |    2 +-
 mozilla/build/unix/mozilla.in |   16 ++++++++++++++++
 4 files changed, 22 insertions(+), 6 deletions(-)

Index: icedove/config/autoconf.mk.in
===================================================================
--- icedove.orig/config/autoconf.mk.in	2012-10-13 14:27:14.000000000 +0530
+++ icedove/config/autoconf.mk.in	2012-10-13 15:52:40.950426682 +0530
@@ -30,14 +30,14 @@
 prefix		= @prefix@
 exec_prefix	= @exec_prefix@
 bindir		= @bindir@
-includedir	= @includedir@/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+includedir	= @includedir@/icedove
 libdir		= @libdir@
 datadir		= @datadir@
 mandir		= @mandir@
-idldir		= $(datadir)/idl/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+idldir		= $(datadir)/idl/icedove
 
-installdir	= $(libdir)/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
-sdkdir		= $(libdir)/$(MOZ_APP_NAME)-devel-$(MOZ_APP_VERSION)
+installdir	= $(libdir)/icedove
+sdkdir		= $(libdir)/icedove-devel
 
 MOZDEPTH	= $(DEPTH)/mozilla
 DIST		= $(MOZDEPTH)/dist
Index: icedove/mail/app/application.ini
===================================================================
--- icedove.orig/mail/app/application.ini	2012-10-13 14:27:15.000000000 +0530
+++ icedove/mail/app/application.ini	2012-10-13 15:52:40.950426682 +0530
@@ -4,7 +4,7 @@
 
 #filter substitution
 [App]
-Name=Thunderbird
+Name=Icedove
 Version=@APP_VERSION@
 BuildID=@GRE_BUILDID@
 #ifdef MOZ_SOURCE_REPO
Index: icedove/mail/confvars.sh
===================================================================
--- icedove.orig/mail/confvars.sh	2012-10-13 14:27:15.000000000 +0530
+++ icedove/mail/confvars.sh	2012-10-13 15:53:24.958428725 +0530
@@ -3,8 +3,8 @@
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
-MOZ_APP_BASENAME=Thunderbird
-MOZ_APP_NAME=thunderbird
+MOZ_APP_BASENAME=Icedove
+MOZ_APP_NAME=icedove
 MOZ_UPDATER=1
 MOZ_THUNDERBIRD=1
 MOZ_CHROME_FILE_FORMAT=omni
Index: icedove/mozilla/build/unix/mozilla.in
===================================================================
--- icedove.orig/mozilla/build/unix/mozilla.in	2012-10-13 14:27:16.000000000 +0530
+++ icedove/mozilla/build/unix/mozilla.in	2012-10-13 15:52:40.950426682 +0530
@@ -65,6 +65,22 @@
   fi
 fi
 
+# On 1st run, create a profile based on application.ini configuration
+# by moving an existing ~/.mozilla-thunderbird profile
+if [ -e "$moz_libdir/application.ini" ]; then
+  pfname=`grep ^Name $moz_libdir/application.ini | cut -d= -f2 | tr 'A-Z' 'a-z'`
+  if [ -f "$HOME/.$pfname" ]; then
+    # should never happen
+    mv $HOME/.$pfname $HOME/.$pfname.moved_out_by_mozilla_startup_script
+  fi
+  if [ "$HOME/.$pfname" != "$HOME/.mozilla-thunderbird" ] && \
+     [ ! -d "$HOME/.$pfname" ] && \
+     [   -d "$HOME/.mozilla-thunderbird" ] ; then
+    echo "*INFO* No $HOME/.$pfname detected. Moving $HOME/.mozilla-thunderbird into this place"
+    mv $HOME/.mozilla-thunderbird $HOME/.$pfname
+  fi
+fi
+
 script_args=""
 debugging=0
 MOZILLA_BIN="${progbase}-bin"
