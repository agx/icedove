From: Mike Hommey <mh@glandium.org>
Date: Tue, 23 Mar 2010 11:57:28 +0100
Subject: [PATCH] Download search engine icons when searchplugin is read-only

https://bugzilla.mozilla.org/show_bug.cgi?id=554265
---
 .../toolkit/components/search/nsSearchService.js   |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/mozilla/toolkit/components/search/nsSearchService.js b/mozilla/toolkit/components/search/nsSearchService.js
index af6fd8d..2c9a637 100644
--- a/mozilla/toolkit/components/search/nsSearchService.js
+++ b/mozilla/toolkit/components/search/nsSearchService.js
@@ -1454,7 +1454,8 @@ Engine.prototype = {
       case "https":
       case "ftp":
         // No use downloading the icon if the engine file is read-only
-        if (!this._readOnly) {
+        if (!this._readOnly ||
+            getBoolPref(BROWSER_SEARCH_PREF + "cache.enabled", true)) {
           LOG("_setIcon: Downloading icon: \"" + uri.spec +
               "\" for engine: \"" + this.name + "\"");
           var chan = gIoSvc.newChannelFromURI(uri);
-- 
