From: Ehsan Akhgari <ehsan@mozilla.com>
Date: Fri, 13 Jul 2012 10:40:27 -0400
Subject: Bug 772282 - Hold on to nodes when we delete them in
 nsEditor::MoveNode; r=ehsan a=akeybl

---
 mozilla/editor/libeditor/base/nsEditor.cpp |    7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/mozilla/editor/libeditor/base/nsEditor.cpp b/mozilla/editor/libeditor/base/nsEditor.cpp
index 4f1172b..d6beeb0 100644
--- a/mozilla/editor/libeditor/base/nsEditor.cpp
+++ b/mozilla/editor/libeditor/base/nsEditor.cpp
@@ -1762,10 +1762,11 @@ nsEditor::MoveNode(nsIDOMNode *aNode, nsIDOMNode *aParent, PRInt32 aOffset)
     aOffset--;  // this is because when we delete aNode, it will make the offsets after it off by one
   }
 
-  // put aNode in new parent
-  res = DeleteNode(aNode);
+  // Hold a reference so aNode doesn't go away when we remove it (bug 772282)
+  nsCOMPtr<nsIDOMNode> node = aNode;
+  res = DeleteNode(node);
   if (NS_FAILED(res)) return res;
-  return InsertNode(aNode, aParent, aOffset);
+  return InsertNode(node, aParent, aOffset);
 }
 
 #ifdef XP_MAC
