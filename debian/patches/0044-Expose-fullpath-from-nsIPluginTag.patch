From: Mike Hommey <mh@glandium.org>
Date: Sat, 6 Mar 2010 11:53:30 +0100
Subject: Expose fullpath from nsIPluginTag

https://bugzilla.mozilla.org/show_bug.cgi?id=550668
---
 .../modules/plugin/base/public/nsIPluginTag.idl    |    6 ++++++
 mozilla/modules/plugin/base/src/nsPluginHost.cpp   |    9 ++++++++-
 mozilla/modules/plugin/base/src/nsPluginHost.h     |    3 ++-
 3 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/mozilla/modules/plugin/base/public/nsIPluginTag.idl b/mozilla/modules/plugin/base/public/nsIPluginTag.idl
index 9f42f3b..ef03939 100644
--- a/mozilla/modules/plugin/base/public/nsIPluginTag.idl
+++ b/mozilla/modules/plugin/base/public/nsIPluginTag.idl
@@ -48,3 +48,9 @@ interface nsIPluginTag : nsISupports
            attribute boolean  disabled;
            attribute boolean  blocklisted;
 };
+
+[scriptable, uuid(d1c7bb66-00ba-4f5c-99fd-f19ee1173a01)]
+interface nsIPluginTag_1_9_2 : nsIPluginTag
+{
+  readonly attribute AUTF8String fullpath;
+};
diff --git a/mozilla/modules/plugin/base/src/nsPluginHost.cpp b/mozilla/modules/plugin/base/src/nsPluginHost.cpp
index d5a0a5c..aa23b16 100644
--- a/mozilla/modules/plugin/base/src/nsPluginHost.cpp
+++ b/mozilla/modules/plugin/base/src/nsPluginHost.cpp
@@ -830,7 +830,7 @@ nsPluginTag::~nsPluginTag()
   }
 }
 
-NS_IMPL_ISUPPORTS1(nsPluginTag, nsIPluginTag)
+NS_IMPL_ISUPPORTS2(nsPluginTag, nsIPluginTag, nsIPluginTag_1_9_2)
 
 static nsresult ConvertToUTF8(nsIUnicodeDecoder *aUnicodeDecoder,
                               nsAFlatCString& aString)
@@ -917,6 +917,13 @@ nsPluginTag::GetFilename(nsACString& aFileName)
 }
 
 NS_IMETHODIMP
+nsPluginTag::GetFullpath(nsACString& aFullPath)
+{
+  aFullPath = mFullPath;
+  return NS_OK;
+}
+
+NS_IMETHODIMP
 nsPluginTag::GetVersion(nsACString& aVersion)
 {
   aVersion = mVersion;
diff --git a/mozilla/modules/plugin/base/src/nsPluginHost.h b/mozilla/modules/plugin/base/src/nsPluginHost.h
index ee16d0d..a1c5c92 100644
--- a/mozilla/modules/plugin/base/src/nsPluginHost.h
+++ b/mozilla/modules/plugin/base/src/nsPluginHost.h
@@ -87,7 +87,7 @@ class nsPluginHost;
 
 // A linked-list of plugin information that is used for instantiating plugins
 // and reflecting plugin information into JavaScript.
-class nsPluginTag : public nsIPluginTag
+class nsPluginTag : public nsIPluginTag_1_9_2
 {
 public:
   enum nsRegisterType {
@@ -97,6 +97,7 @@ public:
 
   NS_DECL_ISUPPORTS
   NS_DECL_NSIPLUGINTAG
+  NS_DECL_NSIPLUGINTAG_1_9_2
 
   nsPluginTag(nsPluginTag* aPluginTag);
   nsPluginTag(nsPluginInfo* aPluginInfo);
-- 
